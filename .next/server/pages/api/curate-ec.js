"use strict";(()=>{var e={};e.id=698,e.ids=[698],e.modules={8667:(e,r)=>{Object.defineProperty(r,"A",{enumerable:!0,get:function(){return t}});var t=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})},33480:(e,r,t)=>{e.exports=t(75600)},75600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},86435:(e,r)=>{Object.defineProperty(r,"M",{enumerable:!0,get:function(){return function e(r,t){return t in r?r[t]:"then"in r&&"function"==typeof r.then?r.then(r=>e(r,t)):"function"==typeof r&&"default"===t?r:void 0}}})},87984:e=>{e.exports=import("openai")},89680:(e,r,t)=>{t.a(e,async(e,a)=>{try{t.r(r),t.d(r,{default:()=>n});var o=t(87984),s=t(93939),i=e([o]);let c=new(o=(i.then?(await i)():i)[0]).default({apiKey:process.env.OPENAI_API_KEY});async function n(e,r){if("POST"!==e.method)return r.status(405).json({error:"Method not allowed"});let{userId:t}=e.body,a=e.headers.authorization||e.headers.Authorization,o=a&&"string"==typeof a&&a.startsWith("Bearer ")?a.replace("Bearer ",""):void 0;if(!t)return r.status(400).json({error:"User ID is required"});if(!o)return r.status(401).json({error:"Missing or invalid access token"});let i=(0,s.createClient)("https://ovmeiqclpdchakrqrjle.supabase.co/","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im92bWVpcWNscGRjaGFrcnFyamxlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTMwOTMwMzIsImV4cCI6MjA2ODY2OTAzMn0.5EGSTlVVzoq9zbmrVcyRhiSLWLu9XPd_8VKJ5wLD39c",{global:{headers:{Authorization:`Bearer ${o}`}}}),{data:n,error:u}=await i.rpc("get_user_profile",{uid:t});if(console.log("[curate-scholarships] Supabase profile query result:",{profile:n,profileError:u}),u||!n)return console.error("Profile not found",u,n),r.status(500).json({error:"Profile not found"});console.log("[curate-ec] Incoming userId:",t);let{data:l,error:d}=await i.from("extracurricular_db").select("*");if(d||!l)return console.error("[curate-ec] Error fetching activities:",d),r.status(500).json({error:"Error fetching activities"});let p=`
You are an expert college admissions advisor. Analyze the user profile and the list of extracurricular activities. Select ONLY the 5 most relevant activities for this user, based on interests, grade, skills, and impact. If you cannot find 5 perfect matches, return the closest matches, but always return 5. Respond ONLY with a valid JSON array of 5 objects, no markdown, no explanation.

User Profile: ${JSON.stringify(n,null,2)}
EC List: ${JSON.stringify(l,null,2)}
Return ONLY a valid JSON array of exactly 5 objects.
`;try{let e=await c.chat.completions.create({model:"gpt-4",messages:[{role:"user",content:p}],temperature:.7}),t=e.choices[0].message.content?.trim();t?.startsWith("```")&&(t=t.replace(/^```[a-zA-Z]*\n?/,"").replace(/```$/,""));let a=JSON.parse(t??"[]");if(!Array.isArray(a))throw Error("OpenAI did not return a JSON array");return r.status(200).json({result:a})}catch(e){return console.error("OpenAI API error:",e),r.status(500).json({error:"Failed to get response from OpenAI API",details:e instanceof Error?e.message:e})}}a()}catch(e){a(e)}})},93939:e=>{e.exports=require("@supabase/supabase-js")},96374:(e,r,t)=>{t.a(e,async(e,a)=>{try{t.r(r),t.d(r,{config:()=>l,default:()=>u,routeModule:()=>d});var o=t(33480),s=t(8667),i=t(86435),n=t(89680),c=e([n]);n=(c.then?(await c)():c)[0];let u=(0,i.M)(n,"default"),l=(0,i.M)(n,"config"),d=new o.PagesAPIRouteModule({definition:{kind:s.A.PAGES_API,page:"/api/curate-ec",pathname:"/api/curate-ec",bundlePath:"",filename:""},userland:n});a()}catch(e){a(e)}})}};var r=require("../../webpack-api-runtime.js");r.C(e);var t=r(r.s=96374);module.exports=t})();